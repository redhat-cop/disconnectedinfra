---
- name: Create template
  template:
    src: esxi_template.tf.j2
    dest: "{{ project_path }}/esxi_template.tf"

- name: Terraform initialize
  ansible.builtin.command:
  args:
    chdir: "{{ project_path }}"
    argv:
    - terraform
    - init

- name: Deploy system
  ansible.builtin.command:
  args:
    chdir: "{{ project_path }}"
    argv:
    - terraform
    - "{{ terraform_state }}"
    - -auto-approve
  environment:
    TF_VAR_root_password: "{{ root_password }}"
